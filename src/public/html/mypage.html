<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë§ˆì´í˜ì´ì§€ - SoundClone</title>
  <link rel="stylesheet" href="../css/index.css">
  <link rel="stylesheet" href="../css/login.css">
  <style>
    /* ë§ˆì´í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
    .mypage-container {
      max-width: 500px;
      margin: 80px auto;
      background: #232323; /* ì–´ë‘ìš´ ì¹´ë“œ ë°°ê²½ */
      padding: 40px;
      border-radius: 8px;
      color: white;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    
    .profile-img-large {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #ff5500; /* ë¸Œëœë“œ ì»¬ëŸ¬ */
      margin-bottom: 20px;
      background: #eee;
    }

    .user-info-box {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      text-align: left;
      margin-bottom: 30px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 16px;
      border-bottom: 1px solid #444;
      padding-bottom: 10px;
    }
    .info-row:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .label {
      color: #aaa;
      font-weight: bold;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì˜¤ë²„ë¼ì´ë”© */
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn-back {
      background-color: #555;
    }
    .btn-back:hover {
      background-color: #444;
    }

    .btn-delete {
      background-color: #d32f2f; /* ë¹¨ê°„ìƒ‰ ê²½ê³  */
    }
    .btn-delete:hover {
      background-color: #b71c1c;
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo" onclick="location.href='home.html'" style="cursor:pointer;">ğŸµ SoundClone</div>
    <nav>
      <ul class="menu">
        <li><a href="home.html">Home</a></li>
        <li><a href="library.html">Library</a></li>
      </ul>
    </nav>
  </header>

  <div class="mypage-container">
    <h2>My Page</h2>

    <div id="profile-area">
      <p>ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <div class="btn-group">
      <button class="btn-back" onclick="location.href='home.html'">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      <button class="btn-delete" onclick="deleteMyAccount()">íšŒì› íƒˆí‡´</button>
    </div>
  </div>

  <script>
    // 1. ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬ (ë¹„ë¡œê·¸ì¸ ì ‘ê·¼ ì°¨ë‹¨)
    const profileRaw = localStorage.getItem('profile');
    
    if (!profileRaw) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.');
      // íˆìŠ¤í† ë¦¬ë¥¼ ë‚¨ê¸°ì§€ ì•Šê³  ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
      location.replace('login.html'); 
    }

    const profile = JSON.parse(profileRaw);

    // 2. í”„ë¡œí•„ ì •ë³´ ë Œë”ë§
    const profileArea = document.getElementById('profile-area');
    profileArea.innerHTML = `
      <img src="${profile.img || '../assets/default_profile.jpg'}" 
           class="profile-img-large" 
           onerror="this.src='../assets/default_profile.jpg'" 
           alt="í”„ë¡œí•„ ì´ë¯¸ì§€" />
      
      <div class="user-info-box">
        <div class="info-row">
          <span class="label">ë‹‰ë„¤ì„</span>
          <span>${profile.name}</span>
        </div>
        <div class="info-row">
          <span class="label">íšŒì› ë²ˆí˜¸</span>
          <span>#${profile.id}</span>
        </div>
      </div>
    `;

    // 3. íšŒì› íƒˆí‡´ í•¨ìˆ˜ (ìš”ì²­í•˜ì‹  ë¡œì§)
    async function deleteMyAccount() {
      // ë°©ì–´ ì½”ë“œ: ì •ë³´ê°€ ì—†ìœ¼ë©´ ì¬ë¡œê·¸ì¸ ìœ ë„
      if (!profile || !profile.id) {
        alert('ì‚¬ìš©ì ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        location.href = 'login.html';
        return;
      }

      if (!confirm('ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì—…ë¡œë“œí•œ ìŒì•…ê³¼ ëª¨ë“  í™œë™ ê¸°ë¡ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.')) return;

      try {
        // ì„œë²„ API í˜¸ì¶œ
        const res = await fetch(`http://localhost:3000/api/users/${profile.id}`, {
          method: 'DELETE'
        });

        if (res.ok) {
          alert('ì •ìƒì ìœ¼ë¡œ íƒˆí‡´ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.');
          
          // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë³´ ì „ì²´ ì‚­ì œ
          localStorage.clear(); 
          
          // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
          location.href = 'login.html'; 
        } else {
          const data = await res.json();
          alert('ì‚­ì œ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
      } catch (err) {
        console.error(err);
        alert('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
  </script>
</body>
</html>